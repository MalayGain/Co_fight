{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport PropTypes from 'prop-types';\nimport { document } from '../utils/globals';\n\nfunction noop() {}\n\nfunction defaultOnError(event) {\n  if (event) {\n    console.error(event.error);\n  }\n}\n\nvar propTypes = {\n  container: PropTypes.object,\n  gl: PropTypes.object,\n  mapboxApiAccessToken: PropTypes.string,\n  mapboxApiUrl: PropTypes.string,\n  attributionControl: PropTypes.bool,\n  preserveDrawingBuffer: PropTypes.bool,\n  reuseMaps: PropTypes.bool,\n  transformRequest: PropTypes.func,\n  mapOptions: PropTypes.object,\n  mapStyle: PropTypes.oneOfType([PropTypes.string, PropTypes.object]),\n  visible: PropTypes.bool,\n  asyncRender: PropTypes.bool,\n  onLoad: PropTypes.func,\n  onError: PropTypes.func,\n  width: PropTypes.number,\n  height: PropTypes.number,\n  viewState: PropTypes.object,\n  longitude: PropTypes.number,\n  latitude: PropTypes.number,\n  zoom: PropTypes.number,\n  bearing: PropTypes.number,\n  pitch: PropTypes.number,\n  altitude: PropTypes.number\n};\nvar defaultProps = {\n  container: document.body,\n  mapboxApiAccessToken: getAccessToken(),\n  mapboxApiUrl: 'https://api.mapbox.com',\n  preserveDrawingBuffer: false,\n  attributionControl: true,\n  reuseMaps: false,\n  mapOptions: {},\n  mapStyle: 'mapbox://styles/mapbox/light-v8',\n  visible: true,\n  asyncRender: false,\n  onLoad: noop,\n  onError: defaultOnError,\n  width: 0,\n  height: 0,\n  longitude: 0,\n  latitude: 0,\n  zoom: 0,\n  bearing: 0,\n  pitch: 0,\n  altitude: 1.5\n};\nexport function getAccessToken() {\n  var accessToken = null;\n\n  if (typeof window !== 'undefined' && window.location) {\n    var match = window.location.search.match(/access_token=([^&\\/]*)/);\n    accessToken = match && match[1];\n  }\n\n  if (!accessToken && typeof process !== 'undefined') {\n    accessToken = accessToken || process.env.MapboxAccessToken || process.env.REACT_APP_MAPBOX_ACCESS_TOKEN;\n  }\n\n  return accessToken || 'no-token';\n}\n\nfunction checkPropTypes(props) {\n  var component = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'component';\n\n  if (props.debug) {\n    PropTypes.checkPropTypes(propTypes, props, 'prop', component);\n  }\n}\n\nvar Mapbox = function () {\n  function Mapbox(props) {\n    var _this = this;\n\n    _classCallCheck(this, Mapbox);\n\n    _defineProperty(this, \"mapboxgl\", void 0);\n\n    _defineProperty(this, \"props\", defaultProps);\n\n    _defineProperty(this, \"_map\", null);\n\n    _defineProperty(this, \"width\", 0);\n\n    _defineProperty(this, \"height\", 0);\n\n    _defineProperty(this, \"_fireLoadEvent\", function () {\n      _this.props.onLoad({\n        type: 'load',\n        target: _this._map\n      });\n    });\n\n    if (!props.mapboxgl) {\n      throw new Error('Mapbox not available');\n    }\n\n    this.mapboxgl = props.mapboxgl;\n\n    if (!Mapbox.initialized) {\n      Mapbox.initialized = true;\n\n      this._checkStyleSheet(this.mapboxgl.version);\n    }\n\n    this._initialize(props);\n  }\n\n  _createClass(Mapbox, [{\n    key: \"finalize\",\n    value: function finalize() {\n      this._destroy();\n\n      return this;\n    }\n  }, {\n    key: \"setProps\",\n    value: function setProps(props) {\n      this._update(this.props, props);\n\n      return this;\n    }\n  }, {\n    key: \"resize\",\n    value: function resize() {\n      this._map.resize();\n\n      return this;\n    }\n  }, {\n    key: \"redraw\",\n    value: function redraw() {\n      var map = this._map;\n\n      if (map.style) {\n        if (map._frame) {\n          map._frame.cancel();\n\n          map._frame = null;\n        }\n\n        map._render();\n      }\n    }\n  }, {\n    key: \"getMap\",\n    value: function getMap() {\n      return this._map;\n    }\n  }, {\n    key: \"_reuse\",\n    value: function _reuse(props) {\n      this._map = Mapbox.savedMap;\n\n      var oldContainer = this._map.getContainer();\n\n      var newContainer = props.container;\n      newContainer.classList.add('mapboxgl-map');\n\n      while (oldContainer.childNodes.length > 0) {\n        newContainer.appendChild(oldContainer.childNodes[0]);\n      }\n\n      this._map._container = newContainer;\n      Mapbox.savedMap = null;\n\n      if (props.mapStyle) {\n        this._map.setStyle(props.mapStyle, {\n          diff: false\n        });\n      }\n\n      if (this._map.isStyleLoaded()) {\n        this._fireLoadEvent();\n      } else {\n        this._map.once('styledata', this._fireLoadEvent);\n      }\n    }\n  }, {\n    key: \"_create\",\n    value: function _create(props) {\n      if (props.reuseMaps && Mapbox.savedMap) {\n        this._reuse(props);\n      } else {\n        if (props.gl) {\n          var getContext = HTMLCanvasElement.prototype.getContext;\n\n          HTMLCanvasElement.prototype.getContext = function () {\n            HTMLCanvasElement.prototype.getContext = getContext;\n            return props.gl;\n          };\n        }\n\n        var mapOptions = {\n          container: props.container,\n          center: [0, 0],\n          zoom: 8,\n          pitch: 0,\n          bearing: 0,\n          maxZoom: 24,\n          style: props.mapStyle,\n          interactive: false,\n          trackResize: false,\n          attributionControl: props.attributionControl,\n          preserveDrawingBuffer: props.preserveDrawingBuffer\n        };\n\n        if (props.transformRequest) {\n          mapOptions.transformRequest = props.transformRequest;\n        }\n\n        this._map = new this.mapboxgl.Map(Object.assign({}, mapOptions, props.mapOptions));\n\n        this._map.once('load', props.onLoad);\n\n        this._map.on('error', props.onError);\n      }\n\n      return this;\n    }\n  }, {\n    key: \"_destroy\",\n    value: function _destroy() {\n      if (!this._map) {\n        return;\n      }\n\n      if (!Mapbox.savedMap) {\n        Mapbox.savedMap = this._map;\n\n        this._map.off('load', this.props.onLoad);\n\n        this._map.off('error', this.props.onError);\n\n        this._map.off('styledata', this._fireLoadEvent);\n      } else {\n        this._map.remove();\n      }\n\n      this._map = null;\n    }\n  }, {\n    key: \"_initialize\",\n    value: function _initialize(props) {\n      var _this2 = this;\n\n      props = Object.assign({}, defaultProps, props);\n      checkPropTypes(props, 'Mapbox');\n      this.mapboxgl.accessToken = props.mapboxApiAccessToken || defaultProps.mapboxApiAccessToken;\n      this.mapboxgl.baseApiUrl = props.mapboxApiUrl;\n\n      this._create(props);\n\n      var _props = props,\n          container = _props.container;\n      Object.defineProperty(container, 'offsetWidth', {\n        get: function get() {\n          return _this2.width;\n        }\n      });\n      Object.defineProperty(container, 'clientWidth', {\n        get: function get() {\n          return _this2.width;\n        }\n      });\n      Object.defineProperty(container, 'offsetHeight', {\n        get: function get() {\n          return _this2.height;\n        }\n      });\n      Object.defineProperty(container, 'clientHeight', {\n        get: function get() {\n          return _this2.height;\n        }\n      });\n\n      var canvas = this._map.getCanvas();\n\n      if (canvas) {\n        canvas.style.outline = 'none';\n      }\n\n      this._updateMapViewport({}, props);\n\n      this._updateMapSize({}, props);\n\n      this.props = props;\n    }\n  }, {\n    key: \"_update\",\n    value: function _update(oldProps, newProps) {\n      if (!this._map) {\n        return;\n      }\n\n      newProps = Object.assign({}, this.props, newProps);\n      checkPropTypes(newProps, 'Mapbox');\n\n      var viewportChanged = this._updateMapViewport(oldProps, newProps);\n\n      var sizeChanged = this._updateMapSize(oldProps, newProps);\n\n      if (!newProps.asyncRender && (viewportChanged || sizeChanged)) {\n        this.redraw();\n      }\n\n      this.props = newProps;\n    }\n  }, {\n    key: \"_updateMapSize\",\n    value: function _updateMapSize(oldProps, newProps) {\n      var sizeChanged = oldProps.width !== newProps.width || oldProps.height !== newProps.height;\n\n      if (sizeChanged) {\n        this.width = newProps.width;\n        this.height = newProps.height;\n        this.resize();\n      }\n\n      return sizeChanged;\n    }\n  }, {\n    key: \"_updateMapViewport\",\n    value: function _updateMapViewport(oldProps, newProps) {\n      var oldViewState = this._getViewState(oldProps);\n\n      var newViewState = this._getViewState(newProps);\n\n      var viewportChanged = newViewState.latitude !== oldViewState.latitude || newViewState.longitude !== oldViewState.longitude || newViewState.zoom !== oldViewState.zoom || newViewState.pitch !== oldViewState.pitch || newViewState.bearing !== oldViewState.bearing || newViewState.altitude !== oldViewState.altitude;\n\n      if (viewportChanged) {\n        this._map.jumpTo(this._viewStateToMapboxProps(newViewState));\n\n        if (newViewState.altitude !== oldViewState.altitude) {\n          this._map.transform.altitude = newViewState.altitude;\n        }\n      }\n\n      return viewportChanged;\n    }\n  }, {\n    key: \"_getViewState\",\n    value: function _getViewState(props) {\n      var _ref = props.viewState || props,\n          longitude = _ref.longitude,\n          latitude = _ref.latitude,\n          zoom = _ref.zoom,\n          _ref$pitch = _ref.pitch,\n          pitch = _ref$pitch === void 0 ? 0 : _ref$pitch,\n          _ref$bearing = _ref.bearing,\n          bearing = _ref$bearing === void 0 ? 0 : _ref$bearing,\n          _ref$altitude = _ref.altitude,\n          altitude = _ref$altitude === void 0 ? 1.5 : _ref$altitude;\n\n      return {\n        longitude: longitude,\n        latitude: latitude,\n        zoom: zoom,\n        pitch: pitch,\n        bearing: bearing,\n        altitude: altitude\n      };\n    }\n  }, {\n    key: \"_checkStyleSheet\",\n    value: function _checkStyleSheet() {\n      var mapboxVersion = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '0.47.0';\n\n      if (typeof document === 'undefined') {\n        return;\n      }\n\n      try {\n        var testElement = document.createElement('div');\n        testElement.className = 'mapboxgl-map';\n        testElement.style.display = 'none';\n        document.body.appendChild(testElement);\n        var isCssLoaded = window.getComputedStyle(testElement).position !== 'static';\n\n        if (!isCssLoaded) {\n          var link = document.createElement('link');\n          link.setAttribute('rel', 'stylesheet');\n          link.setAttribute('type', 'text/css');\n          link.setAttribute('href', \"https://api.tiles.mapbox.com/mapbox-gl-js/v\".concat(mapboxVersion, \"/mapbox-gl.css\"));\n          document.head.appendChild(link);\n        }\n      } catch (error) {}\n    }\n  }, {\n    key: \"_viewStateToMapboxProps\",\n    value: function _viewStateToMapboxProps(viewState) {\n      return {\n        center: [viewState.longitude, viewState.latitude],\n        zoom: viewState.zoom,\n        bearing: viewState.bearing,\n        pitch: viewState.pitch\n      };\n    }\n  }]);\n\n  return Mapbox;\n}();\n\n_defineProperty(Mapbox, \"initialized\", false);\n\n_defineProperty(Mapbox, \"propTypes\", propTypes);\n\n_defineProperty(Mapbox, \"defaultProps\", defaultProps);\n\n_defineProperty(Mapbox, \"savedMap\", null);\n\nexport { Mapbox as default };","map":{"version":3,"sources":["../../../src/mapbox/mapbox.js"],"names":["console","event","propTypes","container","PropTypes","gl","mapboxApiAccessToken","mapboxApiUrl","attributionControl","preserveDrawingBuffer","reuseMaps","transformRequest","mapOptions","mapStyle","visible","asyncRender","onLoad","onError","width","height","viewState","longitude","latitude","zoom","bearing","pitch","altitude","number","defaultProps","document","getAccessToken","accessToken","window","match","process","component","props","Mapbox","map","type","target","_map","oldContainer","newContainer","diff","getContext","HTMLCanvasElement","center","maxZoom","style","interactive","trackResize","Object","checkPropTypes","get","canvas","oldProps","newProps","viewportChanged","sizeChanged","oldViewState","newViewState","mapboxVersion","testElement","isCssLoaded","link"],"mappings":"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","sourcesContent":["// @flow\n// Copyright (c) 2015 Uber Technologies, Inc.\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* global window, process, HTMLCanvasElement */\nimport PropTypes from 'prop-types';\nimport {document} from '../utils/globals';\n\nfunction noop() {}\n\nfunction defaultOnError(event?: {error: any}) {\n  if (event) {\n    console.error(event.error); // eslint-disable-line\n  }\n}\n\nconst propTypes = {\n  // Creation parameters\n  container: PropTypes.object /** The container to have the map. */,\n  gl: PropTypes.object /** External WebGLContext to use */,\n\n  mapboxApiAccessToken: PropTypes.string /** Mapbox API access token for Mapbox tiles/styles. */,\n  mapboxApiUrl: PropTypes.string,\n  attributionControl: PropTypes.bool /** Show attribution control or not. */,\n  preserveDrawingBuffer: PropTypes.bool /** Useful when you want to export the canvas as a PNG. */,\n  reuseMaps: PropTypes.bool,\n  transformRequest: PropTypes.func /** The transformRequest callback for the map */,\n  mapOptions: PropTypes.object /** Extra options to pass to Mapbox constructor. See #545. **/,\n  mapStyle: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.object\n  ]) /** The Mapbox style. A string url to a MapboxGL style */,\n\n  visible: PropTypes.bool /** Whether the map is visible */,\n  asyncRender: PropTypes.bool /** Whether mapbox should manage its own render cycle */,\n\n  onLoad: PropTypes.func /** The onLoad callback for the map */,\n  onError: PropTypes.func /** The onError callback for the map */,\n\n  // Map view state\n  width: PropTypes.number /** The width of the map. */,\n  height: PropTypes.number /** The height of the map. */,\n\n  viewState: PropTypes.object /** object containing lng/lat/zoom/bearing/pitch */,\n\n  longitude: PropTypes.number /** The longitude of the center of the map. */,\n  latitude: PropTypes.number /** The latitude of the center of the map. */,\n  zoom: PropTypes.number /** The tile zoom level of the map. */,\n  bearing: PropTypes.number /** Specify the bearing of the viewport */,\n  pitch: PropTypes.number /** Specify the pitch of the viewport */,\n  // Note: Non-public API, see https://github.com/mapbox/mapbox-gl-js/issues/1137\n  altitude: PropTypes.number /** Altitude of the viewport camera. Default 1.5 \"screen heights\" */\n};\n\nconst defaultProps = {\n  container: document.body,\n  mapboxApiAccessToken: getAccessToken(),\n  mapboxApiUrl: 'https://api.mapbox.com',\n  preserveDrawingBuffer: false,\n  attributionControl: true,\n  reuseMaps: false,\n  mapOptions: {},\n  mapStyle: 'mapbox://styles/mapbox/light-v8',\n\n  visible: true,\n  asyncRender: false,\n\n  onLoad: noop,\n  onError: defaultOnError,\n\n  width: 0,\n  height: 0,\n  longitude: 0,\n  latitude: 0,\n  zoom: 0,\n  bearing: 0,\n  pitch: 0,\n  altitude: 1.5\n};\n\ntype MapboxGL = {\n  version: string,\n  accessToken: string,\n  baseApiUrl: string,\n  Map: Function\n};\n\nexport type ViewState = {\n  longitude: number,\n  latitude: number,\n  zoom: number,\n  bearing: number,\n  pitch: number,\n  altitude?: number\n};\n\ntype Props = {\n  mapboxgl?: MapboxGL,\n  container: any,\n  gl?: any,\n  mapboxApiAccessToken: string,\n  mapboxApiUrl: string,\n  attributionControl: boolean,\n  preserveDrawingBuffer: boolean,\n  onLoad: Function,\n  onError: Function,\n  reuseMaps: boolean,\n  transformRequest?: Function,\n  mapStyle: any,\n  visible: boolean,\n  asyncRender: boolean,\n  width: number,\n  height: number,\n  viewState?: ViewState,\n  longitude: number,\n  latitude: number,\n  zoom: number,\n  bearing: number,\n  pitch: number,\n  altitude?: number,\n  mapOptions: any\n};\n\n// Try to get access token from URL, env, local storage or config\nexport function getAccessToken(): string {\n  let accessToken = null;\n\n  if (typeof window !== 'undefined' && window.location) {\n    const match = window.location.search.match(/access_token=([^&\\/]*)/);\n    accessToken = match && match[1];\n  }\n\n  if (!accessToken && typeof process !== 'undefined') {\n    // Note: This depends on bundler plugins (e.g. webpack) importing environment correctly\n    accessToken =\n      accessToken || process.env.MapboxAccessToken || process.env.REACT_APP_MAPBOX_ACCESS_TOKEN; // eslint-disable-line\n  }\n\n  // Prevents mapbox from throwing\n  return accessToken || 'no-token';\n}\n\n// Helper function to merge defaultProps and check prop types\nfunction checkPropTypes(props, component = 'component') {\n  // TODO - check for production (unless done by prop types package?)\n  if (props.debug) {\n    PropTypes.checkPropTypes(propTypes, props, 'prop', component);\n  }\n}\n\n// A small wrapper class for mapbox-gl\n// - Provides a prop style interface (that can be trivially used by a React wrapper)\n// - Makes sure mapbox doesn't crash under Node\n// - Handles map reuse (to work around Mapbox resource leak issues)\n// - Provides support for specifying tokens during development\n\nexport default class Mapbox {\n  static initialized: boolean = false;\n  static propTypes: any = propTypes;\n  static defaultProps: any = defaultProps;\n  static savedMap: any = null;\n\n  constructor(props: Props) {\n    if (!props.mapboxgl) {\n      throw new Error('Mapbox not available');\n    }\n\n    this.mapboxgl = props.mapboxgl;\n\n    if (!Mapbox.initialized) {\n      Mapbox.initialized = true;\n\n      // Version detection using babel plugin\n      // $FlowFixMe\n      // const VERSION = typeof __VERSION__ !== 'undefined' ? __VERSION__ : 'untranspiled source';\n      // TODO - expose version for debug\n\n      this._checkStyleSheet(this.mapboxgl.version);\n    }\n\n    this._initialize(props);\n  }\n\n  mapboxgl: MapboxGL;\n  props: Props = defaultProps;\n  _map: any = null;\n  width: number = 0;\n  height: number = 0;\n\n  finalize() {\n    this._destroy();\n    return this;\n  }\n\n  setProps(props: Props) {\n    this._update(this.props, props);\n    return this;\n  }\n\n  // Mapbox's map.resize() reads size from DOM, so DOM element must already be resized\n  // In a system like React we must wait to read size until after render\n  // (e.g. until \"componentDidUpdate\")\n  resize() {\n    this._map.resize();\n    return this;\n  }\n\n  // Force redraw the map now. Typically resize() and jumpTo() is reflected in the next\n  // render cycle, which is managed by Mapbox's animation loop.\n  // This removes the synchronization issue caused by requestAnimationFrame.\n  redraw() {\n    const map = this._map;\n    // map._render will throw error if style does not exist\n    // https://github.com/mapbox/mapbox-gl-js/blob/fb9fc316da14e99ff4368f3e4faa3888fb43c513\n    //   /src/ui/map.js#L1834\n    if (map.style) {\n      // cancel the scheduled update\n      if (map._frame) {\n        map._frame.cancel();\n        map._frame = null;\n      }\n      // the order is important - render() may schedule another update\n      map._render();\n    }\n  }\n\n  // External apps can access map this way\n  getMap() {\n    return this._map;\n  }\n\n  // PRIVATE API\n  _fireLoadEvent = () => {\n    this.props.onLoad({\n      type: 'load',\n      target: this._map\n    });\n  };\n\n  _reuse(props: Props) {\n    this._map = Mapbox.savedMap;\n    // When reusing the saved map, we need to reparent the map(canvas) and other child nodes\n    // intoto the new container from the props.\n    // Step1: reparenting child nodes from old container to new container\n    const oldContainer = this._map.getContainer();\n    const newContainer = props.container;\n    newContainer.classList.add('mapboxgl-map');\n    while (oldContainer.childNodes.length > 0) {\n      newContainer.appendChild(oldContainer.childNodes[0]);\n    }\n    // Step2: replace the internal container with new container from the react component\n    this._map._container = newContainer;\n    Mapbox.savedMap = null;\n\n    // Step3: update style and call onload again\n    if (props.mapStyle) {\n      this._map.setStyle(props.mapStyle, {\n        // From the user's perspective, there's no \"diffing\" on initialization\n        // We always rebuild the style from scratch when creating a new Mapbox instance\n        diff: false\n      });\n    }\n\n    // call onload event handler after style fully loaded when style needs update\n    if (this._map.isStyleLoaded()) {\n      this._fireLoadEvent();\n    } else {\n      this._map.once('styledata', this._fireLoadEvent);\n    }\n  }\n\n  _create(props: Props) {\n    // Reuse a saved map, if available\n    if (props.reuseMaps && Mapbox.savedMap) {\n      this._reuse(props);\n    } else {\n      if (props.gl) {\n        const getContext = HTMLCanvasElement.prototype.getContext;\n        // Hijack canvas.getContext to return our own WebGLContext\n        // This will be called inside the mapboxgl.Map constructor\n        // $FlowFixMe\n        HTMLCanvasElement.prototype.getContext = () => {\n          // Unhijack immediately\n          // $FlowFixMe\n          HTMLCanvasElement.prototype.getContext = getContext;\n          return props.gl;\n        };\n      }\n\n      const mapOptions: any = {\n        container: props.container,\n        center: [0, 0],\n        zoom: 8,\n        pitch: 0,\n        bearing: 0,\n        maxZoom: 24,\n        style: props.mapStyle,\n        interactive: false,\n        trackResize: false,\n        attributionControl: props.attributionControl,\n        preserveDrawingBuffer: props.preserveDrawingBuffer\n      };\n      // We don't want to pass a null or no-op transformRequest function.\n      if (props.transformRequest) {\n        mapOptions.transformRequest = props.transformRequest;\n      }\n      this._map = new this.mapboxgl.Map(Object.assign({}, mapOptions, props.mapOptions));\n\n      // Attach optional onLoad function\n      this._map.once('load', props.onLoad);\n      this._map.on('error', props.onError);\n    }\n\n    return this;\n  }\n\n  _destroy() {\n    if (!this._map) {\n      return;\n    }\n\n    if (!Mapbox.savedMap) {\n      Mapbox.savedMap = this._map;\n\n      // deregister the mapbox event listeners\n      this._map.off('load', this.props.onLoad);\n      this._map.off('error', this.props.onError);\n      this._map.off('styledata', this._fireLoadEvent);\n    } else {\n      this._map.remove();\n    }\n\n    this._map = null;\n  }\n\n  _initialize(props: Props) {\n    props = Object.assign({}, defaultProps, props);\n    checkPropTypes(props, 'Mapbox');\n\n    // Creation only props\n    this.mapboxgl.accessToken = props.mapboxApiAccessToken || defaultProps.mapboxApiAccessToken;\n    this.mapboxgl.baseApiUrl = props.mapboxApiUrl;\n\n    this._create(props);\n\n    // Hijack dimension properties\n    // This eliminates the timing issue between calling resize() and DOM update\n    /* eslint-disable accessor-pairs */\n    const {container} = props;\n    // $FlowFixMe\n    Object.defineProperty(container, 'offsetWidth', {get: () => this.width});\n    // $FlowFixMe\n    Object.defineProperty(container, 'clientWidth', {get: () => this.width});\n    // $FlowFixMe\n    Object.defineProperty(container, 'offsetHeight', {\n      get: () => this.height\n    });\n    // $FlowFixMe\n    Object.defineProperty(container, 'clientHeight', {\n      get: () => this.height\n    });\n\n    // Disable outline style\n    const canvas = this._map.getCanvas();\n    if (canvas) {\n      canvas.style.outline = 'none';\n    }\n\n    this._updateMapViewport({}, props);\n    this._updateMapSize({}, props);\n\n    this.props = props;\n  }\n\n  _update(oldProps: Props, newProps: Props) {\n    if (!this._map) {\n      return;\n    }\n\n    newProps = Object.assign({}, this.props, newProps);\n    checkPropTypes(newProps, 'Mapbox');\n\n    const viewportChanged = this._updateMapViewport(oldProps, newProps);\n    const sizeChanged = this._updateMapSize(oldProps, newProps);\n\n    if (!newProps.asyncRender && (viewportChanged || sizeChanged)) {\n      this.redraw();\n    }\n\n    this.props = newProps;\n  }\n\n  // Note: needs to be called after render (e.g. in componentDidUpdate)\n  _updateMapSize(oldProps: any, newProps: Props) {\n    const sizeChanged = oldProps.width !== newProps.width || oldProps.height !== newProps.height;\n    if (sizeChanged) {\n      this.width = newProps.width;\n      this.height = newProps.height;\n      this.resize();\n    }\n    return sizeChanged;\n  }\n\n  _updateMapViewport(oldProps: any, newProps: Props) {\n    const oldViewState = this._getViewState(oldProps);\n    const newViewState = this._getViewState(newProps);\n\n    const viewportChanged =\n      newViewState.latitude !== oldViewState.latitude ||\n      newViewState.longitude !== oldViewState.longitude ||\n      newViewState.zoom !== oldViewState.zoom ||\n      newViewState.pitch !== oldViewState.pitch ||\n      newViewState.bearing !== oldViewState.bearing ||\n      newViewState.altitude !== oldViewState.altitude;\n\n    if (viewportChanged) {\n      this._map.jumpTo(this._viewStateToMapboxProps(newViewState));\n\n      // TODO - jumpTo doesn't handle altitude\n      if (newViewState.altitude !== oldViewState.altitude) {\n        this._map.transform.altitude = newViewState.altitude;\n      }\n    }\n    return viewportChanged;\n  }\n\n  _getViewState(props: Props): ViewState {\n    const {longitude, latitude, zoom, pitch = 0, bearing = 0, altitude = 1.5} =\n      props.viewState || props;\n    return {longitude, latitude, zoom, pitch, bearing, altitude};\n  }\n\n  _checkStyleSheet(mapboxVersion: string = '0.47.0') {\n    if (typeof document === 'undefined') {\n      return;\n    }\n\n    // check mapbox styles\n    try {\n      const testElement = document.createElement('div');\n      testElement.className = 'mapboxgl-map';\n      testElement.style.display = 'none';\n      document.body.appendChild(testElement);\n      const isCssLoaded = window.getComputedStyle(testElement).position !== 'static';\n\n      if (!isCssLoaded) {\n        // attempt to insert mapbox stylesheet\n        const link = document.createElement('link');\n        link.setAttribute('rel', 'stylesheet');\n        link.setAttribute('type', 'text/css');\n        link.setAttribute(\n          'href',\n          `https://api.tiles.mapbox.com/mapbox-gl-js/v${mapboxVersion}/mapbox-gl.css`\n        );\n        document.head.appendChild(link);\n      }\n    } catch (error) {\n      // do nothing\n    }\n  }\n\n  _viewStateToMapboxProps(viewState: ViewState) {\n    return {\n      center: [viewState.longitude, viewState.latitude],\n      zoom: viewState.zoom,\n      bearing: viewState.bearing,\n      pitch: viewState.pitch\n    };\n  }\n}\n"]},"metadata":{},"sourceType":"module"}